<html>
<head>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


<script>
    $.getJSON( "http://texasatlas.arch.tamu.edu:6080/arcgis/rest/services?f=pjson",getFolders);

    var folderLinks = [];
    var serviceFolderLinks = [];
    var currentList;
    var currentIndex;

    function getFolders(data)
    {
        $.each( data.folders, makeFolderLinks);

    }

    function makeFolderLinks( index, folder )
    {
        var folderName = folder;
        currentIndex = index;

        folderLinks.push("http://texasatlas.arch.tamu.edu:6080/arcgis/rest/services/" +folderName + "?f=pjson");
        //jsonFolderLinks


        var list = $("#folderList");
        list.append("<li>" + folderName + "<ul id=\"sublist" +index+ "\"><li>red</li></ul>"+"</li>" );

        var linksList = $("#folderLinks");
        linksList.append("<li>" + folderLinks[index] +  "</li>" );

//        currentList = $("#item" +index);
//        currentList.append("<ul id=\"sublist\"" +index+ "></ul>");

        getSubfolderData(folderLinks[index]);

        //extra testing code. Should put "test" in the list
        var list5 = $("#sublist" +currentIndex);
        list5.append("<li>test</li>" );


    }

    function getSubfolderData(link){
        $.getJSON( link, handleGet);

    }

    function handleGet(data)
    {
        $.each( data.services, handleItem);

    }

    function handleItem( index, service )
    {
        var folderName = service.name.substring(2, service.name.length);


        serviceFolderLinks.push("http://texasatlas.arch.tamu.edu:6080/arcgis/rest/services/CA" +folderName);

        var list2 = $("#list2");
        list2.append("<li>" + serviceFolderLinks[index] + "</li>" );

        var list = $("#sublist" +currentIndex);
        list.append("<li>" + folderName + "</li>" );


    }
</script>

</head>
<body>

    <ul id="folderList">
        <li>green
            <ul id="list"><li>red</li></ul>
        </li>
    </ul>

    <ul id="folderLinks">
        <ul id="list2"></ul>
    </ul>

</body>
</html>
